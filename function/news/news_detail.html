<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no'>
    <link rel="icon" href="/image/myicon.png" type="image/x-icon"/>
    <link rel='stylesheet' type='text/css' href='/index.css'>
    <link rel='stylesheet' type='text/css' href='/lib/bootstrap-4.0.0/css/bootstrap.min.css'>
    <link rel='stylesheet' type='text/css' href='/lib/font-awesome-4.7.0/css/font-awesome.min.css'>
    <script src='/lib/jquery-3.2.1.min.js'></script>
    <script src='/lib/common.js'></script>
    <script src='/lib/english.js'></script>
    <title>在学习中成长</title>
    <style>
        .news_content {
            font-family: "Arial", "Times New Roman", "楷体_GB2312", 楷体 "," 华文楷体 "," 宋体 ";
            font-size: 0.5rem;
        }

        #explain {
            position: fixed;
            bottom: 0;
            color: #fff;
            width: 100%;
        }
    </style>
    <script>
        var news_id = "";
        var section_count = 0;
        var append_mode = false; // 追加模式查词
        $(function () {
            news_id = GetQueryString("news_id");
            var sql = "SELECT * FROM english_news WHERE id='" + news_id + "'";
            $.post("../common_logic.php", {
                type: "query_sql_get_data2",
                sql: sql
            }, function (data) {
                var news_info = eval("(" + data + ")");
                news_info = news_info[0];
                var chns = news_info.chn.split("|*|");
                var engs = news_info.eng.split("|*|");
                section_count = chns.length;
                $("#news_title").html(news_info.title + " <img id='translate' src='/image/translate.png' style='width: 40px; height: 35px;'>");
                var html = "";
                for (var idx in chns) {
                    var eng_word_wrap = get_query_sentence_from_normal(engs[idx]);
                    html += "<p'>" + eng_word_wrap + "</p>";
                    html += "<p class='card-text text-primary translate'>" + chns[idx] + "</p>";
                }
                $("#new_audio").attr("src", news_info.audio_url);
                $("#replay_div").css("height", $("#new_audio").outerHeight());
                $("#content").html(html);
                $("#explain").hide();
                $(".translate").hide();
                $("#translate").click(function () {
                    $(".translate").toggle(1000);
                });
                $("#audio_replay").click(function () {
                    if ($(this).hasClass("bg-danger text-white")) {
                        $(this).removeClass("bg-danger text-white");
                        $("#new_audio").removeAttr("loop");
                    } else {
                        $(this).addClass("bg-danger text-white");
                        $("#new_audio").attr("loop", "loop");
                    }
                });
                regist_word_translate(set_explain_word, query_word_callback);
            });
        });

        function set_explain_word(word) {
            if (append_mode) {
                word = $("#query_word").val() + " " + word;
            }
            $("#word_sound").attr("word", word);
            $("#query_word").val(word);
            $("#explain").show();
            return word;
        }

        function query_word_callback(explain_info) {
            var explains = "";
            for (var i = 0; i < explain_info.explains.length; i++) {
                explains += explain_info.explains[i] + "<br>";
            }
            $("#phonetic").html(explain_info.phonetic);
            $("#word_explain").html(explains);
        }

        function query() {
            var word = $("#query_word").val();
            query_word(word, query_word_callback);
        }

        function explain_control() {
            $("#explain").toggle();
            $("#query_word").val("");
            append_mode_change();
        }

        function append_mode_change() {
            var btn = $("#append_mode");
            if (btn.hasClass("btn-danger")) {
                btn.removeClass("btn-danger");
                append_mode = false;
            } else {
                btn.addClass("btn-danger");
                append_mode = true;
            }
        }
    </script>
</head>
<body>
<audio id="play_sound"></audio>
<div id="explain" style="z-index: 999;" class="bg-primary">
    <div class="input-group">
        <div class="input-group-prepend">
            <button id="append_mode" class="btn" type="button" onclick="append_mode_change();"><i
                    class="fa fa-plus"></i></button>
            <button id="word_sound" class="btn btn-warning" type="button" onclick="play_voice();"><i
                    class="fa fa-volume-up"></i>
            </button>
            <button class="btn btn-info" type="button" onclick="query();">查</button>
        </div>
        <input id="query_word" type="text" class="form-control" placeholder="query word">
        <div class="input-group-append">
            <button class="btn btn-warning" type="button" onclick="explain_control();"><i class="fa fa-close"></i>
            </button>
        </div>
    </div>
    <div class="p-2" style="font-size: 14px;">
        <div id="phonetic" class="font-weight-bold ml-2 mb-1 text-warning"></div>
        <div id="word_explain" class="ml-2"></div>
    </div>
</div>

<nav class="navbar  navbar-dark bg-primary text-white" style="height: 50px;">
    <a class="navbar-brand" href="#">
        <!--<img src="/image/head.jpg" width="40" height="40" class="d-inline-block align-top" alt="">-->
        每日英文短新闻
        <!--<div class="d-inline-block"><a href="news_list.html" class="btn btn-success">列表</a></div>-->
    </a>
</nav>

<div class="input-group mb-3">
    <div id="replay_div" class="input-group-prepend">
        <span id="audio_replay" class="input-group-text border-0"><i
                class="fa fa-play-circle"></i> </span>
    </div>
    <audio id="new_audio" class="form-control p-0 border-0" controls="controls" controlsList="nodownload"
           src=""></audio>
</div>

<!--<audio id="new_audio1" class="w-100" controls="controls" controlsList="nodownload" src=""></audio>-->


<div class="container">
    <div class="row">
        <div class="col-12">
            <h5 id="news_title" class="text-primary m-0">Example heading</h5>
            <div id="content" class="news_content">
            </div>
        </div>
    </div>
</div>

<iframe id="foot" src="/template/foot.html" class="w-100 mt-2" scrolling="no" frameborder="0"
        style="height: 100px; display: block;"></iframe>
</body>
</html>