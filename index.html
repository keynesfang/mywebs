<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name='Keywords' Content='英语听力,英语单词,英语语法'>
    <meta name='Description' Content='在学习中成长的目标是为大众免费提供英语的各类学习资源,包含听力,单词,语法等。所有资源也仅限用于学习。'>
    <meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no'>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="./image/myicon.png" type="image/x-icon"/>
    <link rel='stylesheet' type='text/css' href='lib/bootstrap-4.0.0/css/bootstrap.min.css'>
    <link rel='stylesheet' type='text/css' href='/lib/font-awesome-4.7.0/css/font-awesome.min.css'>
    <link rel='stylesheet' type='text/css' href='/common.css'>
    <script src='/lib/jquery-3.2.1.min.js'></script>
    <script src='/lib/popper.min.js'></script>
    <script src='/lib/bootstrap-4.0.0/js/bootstrap.min.js'></script>
    <script src='/lib/common.js'></script>
    <script src='/lib/english.js'></script>
    <title>在学习中成长</title>
    <style>
        body {
            box-sizing: border-box;
            overflow-x: hidden;
        }

        #show_date {
            margin-left: 10px;
        }

        #header {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 300px;
            background-image: url(image/header_bg_2.png);
            margin: 0 auto;
            border-bottom-right-radius: 15px;
            border-bottom-left-radius: 15px;
        }

        #sub_title2 {
            text-align: center;
            font-size: 13px;
            position: absolute;
            top: 60px;
            left: 30px;
        }

        #output_bar {
            width: 96%;
            border: 5px solid #000;
            border-radius: 5px;
            position: absolute;
            top: 110px;
            left: 2%;
        }

        #sub_frame {
            border: 0;
            width: 94%;
            position: absolute;
            top: 113px;
            left: 3%;
        }

        #menu_bar {
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        #explain_bar {
            position: fixed;
            top: 55px;
            width: 100%;
        }

        #menu {
            height: 42px;
            margin: 0 auto;
            width: 94%;
            border-bottom-right-radius: 15px;
            border-bottom-left-radius: 15px;
        }

        #explain {
            margin: 0 auto;
            color: #fff;
            max-width: 600px;
            width: 100%;
            z-index: 999;
            display: none;
            position: relative;
            border-radius: 5px;
        }

        .level_div {
            position: absolute;
            top: 3px;
            right: 5px;
        }

        .level {
            width: 24px;
            height: 24px;
        }

        .menu_name {
            font-size: 12px;
            color: #ffc107;
        }

        #page_loading {
            position: absolute;
            top: 200px;
            width: 200px;
            text-align: center;
            background:rgba(2,2,2,0.6);
            padding: 20px;
            border-radius: 10px;
            z-index: 999;
            font-size: 6px;
        }

        .input_add_mode {
            background-color: #dc3545;
            color: #fff;
        }

        .input_normal_mode {
            background-color: #fff;
            color: #000;
        }
    </style>
    <script>
        var explain = "";
        var append_mode = false; // 追加模式查词
        var source_type = ""; // 增加生词的来源类型
        var source_id = ""; // 增加生词的来源标识
        $(function () {
            var type = GetQueryString("type");
            var id = GetQueryString("id");
            if (type) {
                var url = "";
                if (type == "news") {
                    url = "/function/news/news_detail2.html?news_id=" + id;
                }
                if (type == "introduce") {
                    url = "/notice.html";
                }
                if (type == "pronunciation") {
                    url = "/function/pronunciation/introduce.html";
                }
                if (type == "glossary") {
                    url = "/function/glossary/menu.html";
                }
                if (type == "express") {
                    url = "/function/express/express_menu.html";
                }
                $("#sub_frame").attr("src", url);
            }
            explain = $("#explain");
            set_frame_height();
            var sub_frame_width = $("#sub_frame").width();
            $("#page_loading").css("left", (sub_frame_width-200)/2);
            $("#menu").css("width", sub_frame_width);

            $(".show_date").html(getToday());
            $(".menu_btn, .my_menu").click(function () {
                $("#page_loading").show();
                explain.hide();
                $(".bottom_menu_btn").removeClass("btn-warning");
                $(".bottom_menu_btn").addClass("btn-dark");
                $("#sub_frame").attr("src", $(this).attr("link"));
                $("#page_loading").hide();
            });
            $(".bottom_menu_btn").click(function () {
                $(".bottom_menu_btn").removeClass("btn-warning");
                $(".bottom_menu_btn").addClass("btn-dark");
                $(this).removeClass("btn-dark");
                $(this).addClass("btn-warning");
            });
//            $("#header_switch").click(function () {
//                $("#show_header").toggle();
//                // $(".menu_name").toggle();
//                $("#show_header_simple").toggle();
//                set_frame_height();
//                set_height();
//            });
        });

        function set_frame_height() {
//            var sub_height = 156;
//            var output_bar_top = 110;
//            if ($('#show_header').is(':hidden')) { // 如果长头部被隐藏
//                sub_height = 126;
//                output_bar_top = 80;
//            }
            var sub_height = 134;
            var output_bar_top = 88;
            document.getElementById("sub_frame").height = document.documentElement.clientHeight - sub_height;
            $("#output_bar").css("top", output_bar_top);
            $("#sub_frame").css("top", output_bar_top + 3);
        }

        function append_mode_change(self) {
            var input = $("#query_word");
            if (input.hasClass("input_add_mode")) {
                $(self).removeClass("bg-danger");
                $(self).removeClass("text-light");
                input.removeClass("input_add_mode");
                input.addClass("input_normal_mode");
                append_mode = false;
            } else {
                $(self).addClass("bg-danger");
                $(self).addClass("text-light");
                input.addClass("input_add_mode");
                input.removeClass("input_normal_mode");
                append_mode = true;
            }
            return false;
        }
        
        function clear_word_input() {
            $("#query_word").val("");
            $("#phonetic").html("");
            $("#word_explain").html("");
        }

        function set_explain_word(word) {
            $("#loading").show();
            $("#explain_detail").hide();
            if (append_mode) {
                word = $("#query_word").val() + " " + word;
            }
            var new_word_arr = get_my_new_word_from_storage();
            var pos = get_array_item_index(new_word_arr, word, true);
            // 设置加入词本按钮的可点属性
            if (pos !== "") {
                $('#btn_add_new_word').attr('disabled', "true");
            } else {
                $('#btn_add_new_word').removeAttr("disabled");
            }
            $("#word_sound").attr("word", word);
            $("#query_word").val(word);
            explain.show();
            return word;
        }

        function query() {
            var word = $("#query_word").val();
            word = $.trim(word);
            if (word) {
                $("#word_sound").attr("word", word);
                query_word(word, query_word_callback);
            } else {
                $("#phonetic").html("");
                $("#word_explain").html("<div class='text-warning text-center font-weight-bold' style='font-size: 20px;'>Please input a word first!</div>");
            }
        }

        function query_word_callback(explain_info) {
            var explains = "";
            for (var i = 0; i < explain_info.explains.length; i++) {
                explains += explain_info.explains[i] + "<br>";
            }
            $("#phonetic").html(explain_info.phonetic + "<i class='ml-2 fa fa-volume-up' style='font-size: 20px;'></i>");
            $("#word_explain").html(explains);
            $("#loading").hide();
            $("#explain_detail").show();
        }

        function add_the_new_word() {
            var query_word = $("#query_word").val();
            query_word = $.trim(query_word);
            if (!query_word) {
                $("#phonetic").html("");
                $("#word_explain").html("<div class='text-warning text-center font-weight-bold' style='font-size: 20px;'>Please input a word first!</div>");
                return;
            }
            var info = {type: source_type, id: source_id};
            add_new_word(query_word, info);
            $('#btn_add_new_word').attr('disabled', "true");
            // var html = $("#content").html();
            var english_content_div = $('#sub_frame').contents().find("#content");
            var html = english_content_div.html();
            html = add_mark_in_current_page_new_word(html, [query_word]);
            english_content_div.html(html);
            document.getElementById("sub_frame").contentWindow.update_word_show();
        }

        function get_my_new_word_from_storage() {
            var return_arr = "";
            var my_new_word_arr = window.localStorage.getItem('my_new_word');
            if (my_new_word_arr) {
                return_arr = [];
                my_new_word_arr = JSON.parse(my_new_word_arr);
                $.each(my_new_word_arr, function (word, info) {
                    return_arr.push(word);
                });
            }
            return return_arr;
        }

        function set_reward_reading(count, new_word_count) {
            var reward_reading = window.localStorage.getItem('reward_reading');
            if (reward_reading) {
                reward_reading = JSON.parse(reward_reading);
                if (reward_reading["date"] == getToday()) {
                    reward_reading["count"] += count;
                    reward_reading["new_word_count"] += new_word_count;
                } else {
                    reward_reading["date"] = getToday();
                    reward_reading["count"] = count;
                    reward_reading["new_word_count"] = new_word_count;
                }
            } else {
                reward_reading = {"date": getToday(), "count": count, "new_word_count": new_word_count};
            }
            window.localStorage.setItem('reward_reading', JSON.stringify(reward_reading));
        }

        function set_continue_day_count() {
            var continue_day_count = window.localStorage.getItem('continue_day_count');
            if (continue_day_count) {
                continue_day_count = JSON.parse(continue_day_count);
                if (continue_day_count["date"] !== getToday()) {
                    continue_day_count["date"] = getToday();
                    continue_day_count["day_count"] += 1;
                }
            } else {
                continue_day_count = {"date": getToday(), "day_count": 1};
            }
            window.localStorage.setItem('continue_day_count', JSON.stringify(continue_day_count));
            return continue_day_count["day_count"];
        }

        function explain_control() {
            explain.toggle();
        }

        function set_height() {
            var sub_body = $('#sub_frame').contents().find("#sub_body");
            sub_body.css("height", $("#sub_frame").height());
        }
    </script>
</head>
<body class="text-white">
<div id="header">
    <div id="page_loading" style="display: none;">
        <div class="fa-3x">
            <i class="fa fa-spinner fa-spin"></i><div class="pb-2">页面加载中...</div>
        </div>
    </div>
    <div id="show_date" class="show_date" style="font-size: 12px;"></div>
    <div link="/notice.html" class="level_div menu_btn"><img class="level" src="/image/announcement.png"><div class="menu_name">秘诀</div></div>
    <div link="/function/reward/reading.html" class="level_div menu_btn" style="margin-right: 40px;"><img class="level" src="/image/level.png"><div class="menu_name">战绩</div></div>
    <div link="/share.html" class="level_div menu_btn" style="margin-right: 80px;"><img class="level" src="/image/service.png"><div class="menu_name">作者</div></div>
    <div link="/function/glossary/my_glossary2.html" class="level_div menu_btn" style="margin-right: 120px;"><img class="level" src="/image/word.png"><div class="menu_name">生词</div></div>
    <div class="level_div" style="margin-right: 160px;" onclick="explain_control();"><img class="level" src="/image/query.png"><div class="menu_name">查词</div></div>
    <div link="/function/message/message_list.html" class="level_div menu_btn" style="margin-top: 40px;"><img class="level" src="/image/message.png"><div class="menu_name">留言</div></div>
    <div link="/function/situation/situation_type.html" class="level_div menu_btn" style="margin-top: 40px; margin-right: 40px;"><img class="level" src="/image/situaction.png"><div class="menu_name">场景</div></div>
    <div link="/function/video/message_list.html" class="level_div menu_btn" style="margin-top: 40px; margin-right: 80px;"><img class="level" src="/image/video.png"><div class="menu_name">视频</div></div>
    <!--<div id="show_header">-->
        <!--<div class="d-block"></div>-->
        <!--<div id="title" class="mt-4">在学习中成长</div>-->
        <!--<div id="sub_title">Growth In Learning</div>-->
    <!--</div>-->
    <div id="show_header_simple" class="w-100">
        <img src="favicon.ico" style="width:20px; height: 20px; float: left;">
        <h5 class="mt-2 ml-4 mb-0">在学习中成长</h5>
        <div  id="sub_title2">Growth In Learning</div>
    </div>
    <!--<div id="header_switch"-->
         <!--style="position: absolute; top: 0; left: 100px; border: 1px solid #fff; border-bottom-left-radius: 5px; border-bottom-right-radius: 5px;"-->
         <!--class="bg-danger px-2">-->
        <!--<i class="fa fa-chevron-circle-up"></i>-->
        <!--<i class="fa fa-chevron-circle-down"></i>-->
    <!--</div>-->
    <div id="output_bar"></div>
    <!--<iframe id="sub_frame" src="/function/video/message_list.html"></iframe>-->
    <iframe id="sub_frame" src="/function/news/news_list2.html"></iframe>
</div>
<div id="menu_bar">
    <div id="menu" class="bg-primary">
        <div class="btn-toolbar mb-3 d-flex justify-content-center h-100" role="toolbar">
            <div class="btn-group mr-2" role="group">
                <button type="button" class="btn btn-dark menu_btn bottom_menu_btn"
                        link="/function/pronunciation/introduce.html">发音
                </button>
                <button type="button" class="btn btn-warning menu_btn bottom_menu_btn"
                        link="/function/news/news_list2.html">新闻
                </button>
                <button type="button" class="btn btn-dark menu_btn bottom_menu_btn"
                        link="/function/glossary/menu.html">词汇
                </button>
                <button type="button" class="btn btn-dark menu_btn bottom_menu_btn"
                        link="/function/express/express_menu.html">语法
                </button>
            </div>
        </div>
    </div>
</div>

<div id="explain_bar">
    <div id="explain" class="bg-dark">
        <i class="fa fa-caret-up fa-2x text-dark" style="position: absolute; top: -21px; right: 170px;"></i>
        <div id="loading" style="text-align: center; display: none;">
            <div class="fa-3x">
                <i class="fa fa-spinner fa-spin"></i>
            </div>
            <div class="pb-2">单词含义查询中！</div>
        </div>
        <div id="explain_detail">
            <div class="p-2" style="font-size: 14px;">
                <div id="phonetic" class="ml-3 mb-1 text-warning" onclick="play_voice();"></div>
                <div id="word_explain" class="ml-3"></div>
            </div>
        </div>
        <div class="input-group">
            <div class="input-group-prepend">
                <button type="button" class="btn btn-lg btn-dark dropdown-toggle dropdown-toggle-split btn-sm" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="sr-only">Toggle Dropdown</span>
                </button>
                <div class="dropdown-menu">
                    <button class="dropdown-item" onclick="append_mode_change(this);"><i class="fa fa-plus"></i> 词组模式</button>
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item" onclick="add_the_new_word();"><i class="fa fa-plus"></i> 加入词本</button>
                    <div class="dropdown-divider"></div>
                    <button class="dropdown-item" onclick="clear_word_input();"><i class="fa fa-minus"></i> 清空输入</button>
                </div>
            </div>
            <input id="query_word" type="text" class="form-control px-2" placeholder="请输入查询单词" style="border: 1px solid #28a745;">
            <div class="input-group-append">
                <button class="btn btn-dark btn-sm" type="button" onclick="query();">查</button>
                <button class="btn btn-warning btn-sm" type="button" onclick="explain_control();"><i class="fa fa-close"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<audio id="play_sound"></audio>
<span id="word_sound"></span>
</body>
</html>